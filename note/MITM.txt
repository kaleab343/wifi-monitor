# üïµÔ∏è Man-in-the-Middle (MITM) Scanner - Complete Explanation

Great question! Your project has **BOTH Python and C++ implementations** of MITM scanning. Let me explain how each works:

---

## üìã **Two MITM Options Available**

### **Option 1: Python MITM Scanner** (`mitm_passive_scanner.py`)
- **More Advanced** - Full ARP spoofing + deep packet inspection
- **Requires:** Scapy library + Administrator privileges

### **Option 2: C++ MITM Scanner** (`passive_network_monitor.cpp`)  
- **Simpler** - Promiscuous mode packet capture
- **Requires:** Only Administrator privileges (no extra libraries)

---

## üîß **How Each MITM Method Works**

### **üêç Python Version - ARP Spoofing (Active MITM)**

#### **Step 1: ARP Poisoning Attack**
```python
def arp_spoof(self, target_ip, target_mac):
    # Tell the target device: "I am the router!"
    spoof_target = ARP(op=2, pdst=target_ip, hwdst=target_mac, 
                      psrc=self.router_ip, hwsrc=self.my_mac)
    
    # Tell the router: "I am the target device!"
    spoof_gateway = ARP(op=2, pdst=self.router_ip, hwdst=self.gateway_mac,
                       psrc=target_ip, hwsrc=self.my_mac)
```

**What happens:**
- Your PC pretends to be the router to all devices
- Your PC pretends to be each device to the router
- **ALL traffic flows through your PC** (Man-in-the-Middle position)

#### **Step 2: Enable IP Forwarding**
```python
# Windows: Allow packets to pass through
os.system("netsh interface ipv4 set interface forwarding=enabled")
```
- Ensures traffic keeps flowing (not blocking the network)
- Your PC becomes a temporary router

#### **Step 3: Capture & Analyze All Packets**
```python
def packet_handler(self, packet):
    src_mac = packet[Ether].src
    src_ip = packet[IP].src
    
    # Deep packet inspection
    if 'User-Agent' in packet:
        # Detect OS from HTTP headers
    if DHCP in packet:
        # Get hostname from DHCP
    if DNS in packet:
        # Track websites visited
```

**Extracts:**
- MAC address, IP address
- Hostname (from DHCP packets)
- Operating System (from HTTP User-Agent headers)
- Device type (from traffic patterns)
- Websites visited (from DNS queries)
- Traffic statistics (bytes sent/received)

#### **Step 4: Restore Network**
```python
def restore_arp(self, target_ip, target_mac):
    # Send correct ARP information back
    restore_target = ARP(op=2, pdst=target_ip, hwdst=target_mac,
                        psrc=self.router_ip, hwsrc=self.gateway_mac)
```
- Restores normal routing when done
- Removes MITM position safely

---

### **‚ö° C++ Version - Promiscuous Mode (Passive MITM)**

#### **Step 1: Create Raw Socket**
```cpp
SOCKET sock = socket(AF_INET, SOCK_RAW, IPPROTO_IP);
```
- Creates a raw IP socket (low-level access)

#### **Step 2: Enable Promiscuous Mode**
```cpp
DWORD dwValue = 1;
ioctlsocket(sock, SIO_RCVALL, &dwValue);
```

**What this does:**
- Normally, your network card ignores packets not addressed to you
- **Promiscuous mode:** Network card captures **ALL packets** on the network
- Like "wiretapping" the WiFi connection

#### **Step 3: Parse Ethernet & IP Headers**
```cpp
struct EthernetHeader {
    unsigned char dest_mac[6];
    unsigned char src_mac[6];
    unsigned short ether_type;
};

struct IPv4Header {
    unsigned char src_ip[4];
    unsigned char dest_ip[4];
    // ... other fields
};
```

**Extracts from each packet:**
- Source/Destination MAC addresses
- Source/Destination IP addresses
- Packet size & protocol

#### **Step 4: Track All Devices**
```cpp
if (src_ip.substr(0, 8) == "192.168.") {
    discovered_devices[src_mac] = {
        .mac = src_mac,
        .ip = src_ip,
        .packet_count = count,
        .last_seen = timestamp
    };
}
```

---

## üÜö **Comparison: Python vs C++**

| Feature | Python (Scapy) | C++ (Raw Sockets) |
|---------|----------------|-------------------|
| **Setup** | `pip install scapy` | No dependencies |
| **Admin Required** | ‚úÖ Yes | ‚úÖ Yes |
| **Method** | ARP Spoofing (Active MITM) | Promiscuous Mode (Passive) |
| **Detection** | Can intercept ALL traffic | Only sees broadcast/local traffic |
| **Info Extracted** | Hostname, OS, User-Agent, DNS | IP, MAC, Packet counts |
| **Stealth** | ‚ö†Ô∏è Detectable (modifies ARP tables) | ‚úÖ More stealthy (read-only) |
| **Complexity** | Advanced | Simpler |

---

## üöÄ **How to Run MITM Scanner**

### **Method 1: Python MITM (Full Features)**
```batch
run_gui_as_admin_mitm.bat
```

Or manually:
```powershell
# Install scapy
pip install scapy

# Run as Administrator
python mitm_passive_scanner.py 192.168.1.1
```

**Output:** Creates `mitm_devices.json` with detailed device info

### **Method 2: C++ MITM (Simple)**
```powershell
# Compile
g++ passive_network_monitor.cpp -o passive_monitor.exe -lws2_32 -liphlpapi

# Run as Administrator (PowerShell)
.\passive_monitor.exe 30  # Scan for 30 seconds
```

### **Method 3: Via Hybrid GUI**
1. Run: `run_gui_as_admin_mitm.bat`
2. Click **"MITM Passive Scan"** button
3. Wait for results

---

## üìä **Visual Flow Diagram**

### **Normal Network (No MITM):**
```
Device 1 ‚îÄ‚îÄ‚ñ∫ Router ‚îÄ‚îÄ‚ñ∫ Internet
Device 2 ‚îÄ‚îÄ‚ñ∫ Router ‚îÄ‚îÄ‚ñ∫ Internet
Device 3 ‚îÄ‚îÄ‚ñ∫ Router ‚îÄ‚îÄ‚ñ∫ Internet
```

### **With ARP Spoofing (Python):**
```
Device 1 ‚îÄ‚îÄ‚ñ∫ Your PC ‚îÄ‚îÄ‚ñ∫ Router ‚îÄ‚îÄ‚ñ∫ Internet
Device 2 ‚îÄ‚îÄ‚ñ∫ Your PC ‚îÄ‚îÄ‚ñ∫ Router ‚îÄ‚îÄ‚ñ∫ Internet
Device 3 ‚îÄ‚îÄ‚ñ∫ Your PC ‚îÄ‚îÄ‚ñ∫ Router ‚îÄ‚îÄ‚ñ∫ Internet
              ‚Üë
         (Captures everything!)
```

### **With Promiscuous Mode (C++):**
```
Device 1 ‚îÄ‚îÄ‚ñ∫ Router ‚îÄ‚îÄ‚ñ∫ Internet
              ‚Üì (You listen to all traffic)
Device 2 ‚îÄ‚îÄ‚ñ∫ Your PC (Promiscuous NIC)
              ‚Üì
Device 3 ‚îÄ‚îÄ‚ñ∫ Router
```

---

## ‚ö†Ô∏è **Important Notes**

### **1. Administrator/Root Required**
Both methods need elevated privileges because they:
- Access raw network sockets
- Modify network settings
- Capture packets not addressed to your PC

### **2. Legal/Ethical Use Only**
‚ö†Ô∏è **Only use on YOUR OWN network!**
- ARP spoofing on networks you don't own is illegal
- Only for network administration/troubleshooting

### **3. Network Impact**
- **Python (ARP):** Temporarily intercepts traffic (may slow network slightly)
- **C++ (Promiscuous):** Read-only, no network impact

---

## üéØ **Which Should You Use?**

### **Use Python MITM if:**
‚úÖ You want **maximum information** (hostname, OS, DNS queries)  
‚úÖ You have Scapy installed  
‚úÖ You need to detect **silent devices** (forces traffic through you)

### **Use C++ MITM if:**
‚úÖ You want **simple, fast** scanning  
‚úÖ You don't want to install dependencies  
‚úÖ You prefer **passive monitoring** (more stealthy)  
‚úÖ You're comfortable with C++ compilation

---

**Would you like me to:**
1. **Show you how to build/compile** the C++ MITM scanner?
2. **Test the MITM scanner** and show you actual output?
3. **Add more features** to detect specific device types?
4. **Explain the security implications** in more detail?
5. **Something else?**